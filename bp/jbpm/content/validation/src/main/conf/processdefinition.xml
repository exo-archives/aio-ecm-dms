<?xml version="1.0" encoding="UTF-8"?>

<process-definition name="content-validation"> 

  <description>create a document and publish it</description>

  <!-- SWIMLANES -->
  <swimlane name="initiator" />
  
  <swimlane name="validator">
    <assignment class="org.exoplatform.processes.contentvalidation.ValidatorAssignementHandler"/>
  </swimlane>

  <!-- START-STATE -->
  <start-state name="start">
    <task swimlane="initiator"/>  
    <transition to="evaluation"/>
  </start-state>
  
  <!-- NODES -->
  <task-node name="evaluation">
    <task swimlane="validator"/>  
    <transition name="approve" to="manage move"/>
    <transition name="disapprove" to="change request"/>
    <transition name="delegate" to="delegate"/>    
    <transition name="refuse" to="end"/>
  </task-node>  

  <task-node name="change request">
    <task swimlane="initiator"/> 
    <transition name="submit" to="evaluation"/>
    <transition name="cancel" to="end"/>
  </task-node>
  
  <process-state name="delegate">
    <sub-process name="content-validation" />
    <variable name="initiator" access="read,write" mapped-name="initiator" />
    <variable name="delegate" access="read,write" mapped-name="exo:validator" />
    <variable name="document-type" access="read,write" mapped-name="document-type" />
    <variable name="nodePath" access="read,write" mapped-name="nodePath" />   
    <variable name="srcWorkspace" access="read,write" mapped-name="srcWorkspace" />   
    <variable name="srcPath" access="read,write" mapped-name="srcPath" />                    
    <variable name="actionName" access="read,write" mapped-name="actionName" />   
    <!--
    <variable name="destWorkspace" access="read,write" mapped-name="destWorkspace" />
    <variable name="destPath" access="read,write" mapped-name="destPath" />      
    -->
    <transition name="end" to="end"/>  
  </process-state>   

  <state name="manage move">
    <event type="node-enter">
      <action class="org.exoplatform.processes.contentvalidation.SchedulePublicationTimerActionHandler"/>
    </event>
    <transition name="move-done" to="end"/>  
  </state>

  <!-- END-STATE -->
  <end-state name="end" />

</process-definition>
